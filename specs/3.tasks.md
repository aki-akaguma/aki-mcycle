# `aki-mcycle` Development Tasks

This document lists the development tasks derived from the design document. All tasks are marked with `[x]` as they represent the work done to implement the current version of the application.

## Project Setup & Configuration
- [x] Initialize `Cargo.toml` with necessary metadata (name, version, edition).
- [x] Add dependencies: `clap` for CLI parsing and `regex` for pattern matching.
- [x] Configure the project to build as both a binary (`main.rs`) and a library (`lib.rs`).
- [x] Create `LICENSE-APACHE` and `LICENSE-MIT` files.
- [x] Set up a `.gitignore` file for Rust projects.

## Module: `conf` (CLI & Configuration)
- [x] Create the `conf` module with `mod.rs` and `parse.rs`.
- [x] In `parse.rs`, define the `CmdOpt` struct using `clap::Parser`.
- [x] Add the `-e, --exp` option to `CmdOpt` to accept a regular expression.
- [x] Set the default value for the `--exp` option.
- [x] Add the `-H, --help` flag (handled automatically by `clap`).
- [x] Add the `-V, --version` flag (handled automatically by `clap`).

## Module: `util` (Utilities & Error Handling)
- [x] Create the `util` module with `mod.rs` and `err.rs`.
- [x] In `err.rs`, define the `AkiMcycleError` enum for custom error types.
- [x] Implement `From<io::Error>` for `AkiMcycleError` to handle I/O errors.
- [x] Implement `From<regex::Error>` for `AkiMcycleError` to handle regex parsing errors.

## Module: `run` (Core Logic)
- [x] Create the `run.rs` module.
- [x] Implement the public `execute` function that takes `CmdOpt` as input.
- [x] Add logic to read the entire stream from `std::io::stdin()` into a string.
- [x] Implement the color sequence generator, prioritizing environment variables (`AKI_MCYCLE_COLOR_SEQ_*`) over hardcoded default values.
- [x] Compile the regular expression from the `CmdOpt` configuration.
- [x] Use an iterator (`find_iter`) to find all non-overlapping matches of the regex in the input string.
- [x] Implement the core loop to build the output string, appending non-matching parts and colored matches.
- [x] Implement the color cycler logic within the loop.
- [x] Print the final composed string to `std::io::stdout()`.

## Module: `lib.rs` (Library API)
- [x] Declare the `conf`, `run`, and `util` modules.
- [x] Publicly export the `execute` function and the `AkiMcycleError` type for external use.

## Module: `main.rs` (Application Entry Point)
- [x] Implement the `main` function.
- [x] Call `CmdOpt::parse()` to process command-line arguments.
- [x] Call `run::execute()` with the parsed options.
- [x] Implement a `match` statement to handle the `Result` from `execute`, printing errors to `stderr` and exiting with a non-zero status code on failure.

## Documentation
- [x] Write the `README.md` file with examples and usage instructions.
- [x] Add documentation comments to public functions and types (`lib.rs`, `run.rs`).
